
# Get table mappings from local files
locals {
  somwf3_non_blob_raw_full_mappings=file("${path.module}/../config/dms/WF3_NON_BLOB_TABLES_include.json")
  somwf3_raw_cdc_mappings=file("${path.module}/../config/dms/WF3_CDC_TABLES_include.json")
  somwf3_raw_blob_mappings=file("${path.module}/../config/dms/WF3_BLOB_TABLES_include.json")

  somrbs_non_blob_raw_full_mappings=file("${path.module}/../config/dms/RBS_NON_BLOB_TABLES_include.json")
  somrbs_raw_cdc_mappings=file("${path.module}/../config/dms/RBS_CDC_TABLES_include.json")
  somrbs_raw_blob_mappings=file("${path.module}/../config/dms/RBS_BLOB_TABLES_include.json")

  somggn_non_blob_raw_full_mappings=file("${path.module}/../config/dms/GGN_NON_BLOB_TABLES_include.json")
  somggn_raw_cdc_mappings=file("${path.module}/../config/dms/GGN_CDC_TABLES_include.json")
  somggn_raw_blob_mappings=file("${path.module}/../config/dms/GGN_BLOB_TABLES_include.json")
  
  somano_non_blob_raw_full_mappings=file("${path.module}/../config/dms/ANO_NON_BLOB_TABLES_include.json")
  somano_raw_cdc_mappings=file("${path.module}/../config/dms/ANO_CDC_TABLES_include.json")
  somano_raw_blob_mappings=file("${path.module}/../config/dms/ANO_BLOB_TABLES_include.json") 
   
}

# Reference existing CloudWatch Log Group
data "aws_cloudwatch_log_group" "dms_task" {
  name = "/aws/dms/task/migration"
}

# DMS Replication Task
resource "aws_dms_replication_task" "migration" {
  migration_type           = "full-load"
  replication_instance_arn = data.aws_dms_replication_instance.main.replication_instance_arn
  replication_task_id      = "migration-task-esoms-ggn-non-blob-full"
  source_endpoint_arn      = aws_dms_endpoint.esom_ggn_oracle_source_endpoint.endpoint_arn
  target_endpoint_arn      = aws_dms_endpoint.s3_target_endpoint.endpoint_arn
  table_mappings           = local.table_mappings


  replication_task_settings = jsonencode({
    Logging = {
      EnableLogging = true
      EnableLogContext = true
      LogComponents = [
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TRANSFORMATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_UNLOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "IO" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_LOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "PERFORMANCE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_CAPTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SORTER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "REST_SERVER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "VALIDATOR_EXT" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_APPLY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TASK_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TABLES_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "METADATA_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_FACTORY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMON" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "ADDONS" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "DATA_STRUCTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMUNICATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_TRANSFER" }
      ]
    }
    StreamBufferSettings = {
      StreamBufferCount = 2
      CtrlStreamBufferSizeInMB = 16
      StreamBufferSizeInMB = 16
    }
    ErrorBehavior = {
      FailOnNoTablesCaptured = true
      ApplyErrorUpdatePolicy = "LOG_ERROR"
      FailOnTransactionConsistencyBreached = false
      RecoverableErrorThrottlingMax = 1800
      DataErrorEscalationPolicy = "SUSPEND_TABLE"
      ApplyErrorEscalationCount = 0
      RecoverableErrorStopRetryAfterThrottlingMax = true
      RecoverableErrorThrottling = true
      ApplyErrorFailOnTruncationDdl = false
      DataMaskingErrorPolicy = "STOP_TASK"
      DataTruncationErrorPolicy = "LOG_ERROR"
      ApplyErrorInsertPolicy = "LOG_ERROR"
      EventErrorPolicy = "IGNORE"
      ApplyErrorEscalationPolicy = "LOG_ERROR"
      RecoverableErrorCount = -1
      DataErrorEscalationCount = 0
      TableErrorEscalationPolicy = "STOP_TASK"
      RecoverableErrorInterval = 5
      ApplyErrorDeletePolicy = "IGNORE_RECORD"
      TableErrorEscalationCount = 0
      FullLoadIgnoreConflicts = true
      DataErrorPolicy = "LOG_ERROR"
      TableErrorPolicy = "SUSPEND_TABLE"
    }
    TTSettings = null
    FullLoadSettings = {
      CommitRate = 5000
      StopTaskCachedChangesApplied = false
      StopTaskCachedChangesNotApplied = false
      MaxFullLoadSubTasks = 4
      TransactionConsistencyTimeout = 600
      CreatePkAfterFullLoad = false
      TargetTablePrepMode = "DROP_AND_CREATE"
    }
    TargetMetadata = {
      ParallelApplyBufferSize = 0
      ParallelApplyQueuesPerThread = 0
      ParallelApplyThreads = 0
      TargetSchema = ""
      InlineLobMaxSize = 0
      ParallelLoadQueuesPerThread = 0
      SupportLobs = true
      LobChunkSize = 0
      TaskRecoveryTableEnabled = false
      ParallelLoadThreads = 0
      LobMaxSize = 63
      BatchApplyEnabled = false
      FullLobMode = false
      LimitedSizeLobMode = true
      LoadMaxFileSize = 0
      ParallelLoadBufferSize = 0
    }
    BeforeImageSettings = null
    ControlTablesSettings = {
      historyTimeslotInMinutes = 5
      HistoryTimeslotInMinutes = 5
      StatusTableEnabled = false
      SuspendedTablesTableEnabled = false
      HistoryTableEnabled = false
      ControlSchema = ""
      FullLoadExceptionTableEnabled = false
    }
    LoopbackPreventionSettings = null
    CharacterSetSettings = null
    FailTaskWhenCleanTaskResourceFailed = false
    ChangeProcessingTuning = {
      StatementCacheSize = 50
      CommitTimeout = 1
      RecoveryTimeout = -1
      BatchApplyPreserveTransaction = true
      BatchApplyTimeoutMin = 1
      BatchSplitSize = 0
      BatchApplyTimeoutMax = 30
      MinTransactionSize = 1000
      MemoryKeepTime = 30
      BatchApplyMemoryLimit = 1024
      MemoryLimitTotal = 2048
    }
    ChangeProcessingDdlHandlingPolicy = {
      HandleSourceTableDropped = true
      HandleSourceTableTruncated = true
      HandleSourceTableAltered = true
    }
    PostProcessingRules = null
    TimestampColumnName = "edl_load_date"
  })

  tags = {
    Name         = "migration-task"
    Environment  = var.environment
    Pod          = var.pod
    Businessunit = var.businessunit
  }

}



# Reference existing CloudWatch Log Group for blob task
data "aws_cloudwatch_log_group" "dms_blob_task" {
  name = "/aws/dms/task/blob-migration"
}

resource "aws_dms_replication_task" "somwf3_non_blob_raw_full_migration" {
  migration_type           = "full-load"
  replication_instance_arn = data.aws_dms_replication_instance.main.replication_instance_arn
  replication_task_id      = "migration-task-esoms-wf3-raw-full"
  source_endpoint_arn      = aws_dms_endpoint.esom_wf3_oracle_source_endpoint.endpoint_arn
  target_endpoint_arn      = aws_dms_endpoint.s3_target_endpoint.endpoint_arn
  table_mappings           = local.somwf3_non_blob_raw_full_mappings

  replication_task_settings = jsonencode({
    Logging = {
      EnableLogging = true
      EnableLogContext = true
      LogComponents = [
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TRANSFORMATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_UNLOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "IO" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_LOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "PERFORMANCE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_CAPTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SORTER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "REST_SERVER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "VALIDATOR_EXT" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_APPLY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TASK_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TABLES_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "METADATA_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_FACTORY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMON" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "ADDONS" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "DATA_STRUCTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMUNICATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_TRANSFER" }
      ]
    }
    StreamBufferSettings = {
      StreamBufferCount = 2
      CtrlStreamBufferSizeInMB = 16
      StreamBufferSizeInMB = 16
    }
    ErrorBehavior = {
      FailOnNoTablesCaptured = true
      ApplyErrorUpdatePolicy = "LOG_ERROR"
      FailOnTransactionConsistencyBreached = false
      RecoverableErrorThrottlingMax = 1800
      DataErrorEscalationPolicy = "SUSPEND_TABLE"
      ApplyErrorEscalationCount = 0
      RecoverableErrorStopRetryAfterThrottlingMax = true
      RecoverableErrorThrottling = true
      ApplyErrorFailOnTruncationDdl = false
      DataMaskingErrorPolicy = "STOP_TASK"
      DataTruncationErrorPolicy = "LOG_ERROR"
      ApplyErrorInsertPolicy = "LOG_ERROR"
      EventErrorPolicy = "IGNORE"
      ApplyErrorEscalationPolicy = "LOG_ERROR"
      RecoverableErrorCount = -1
      DataErrorEscalationCount = 0
      TableErrorEscalationPolicy = "STOP_TASK"
      RecoverableErrorInterval = 5
      ApplyErrorDeletePolicy = "IGNORE_RECORD"
      TableErrorEscalationCount = 0
      FullLoadIgnoreConflicts = true
      DataErrorPolicy = "LOG_ERROR"
      TableErrorPolicy = "SUSPEND_TABLE"
    }
    TTSettings = null
    FullLoadSettings = {
      CommitRate = 5000
      StopTaskCachedChangesApplied = false
      StopTaskCachedChangesNotApplied = false
      MaxFullLoadSubTasks = 4
      TransactionConsistencyTimeout = 600
      CreatePkAfterFullLoad = false
      TargetTablePrepMode = "DROP_AND_CREATE"
    }
    TargetMetadata = {
      ParallelApplyBufferSize = 0
      ParallelApplyQueuesPerThread = 0
      ParallelApplyThreads = 0
      TargetSchema = ""
      InlineLobMaxSize = 0
      ParallelLoadQueuesPerThread = 0
      SupportLobs = true
      LobChunkSize = 0
      TaskRecoveryTableEnabled = false
      ParallelLoadThreads = 0
      LobMaxSize = 32
      BatchApplyEnabled = false
      FullLobMode = false
      LimitedSizeLobMode = true
      LoadMaxFileSize = 0
      ParallelLoadBufferSize = 0
    }
    BeforeImageSettings = null
    ControlTablesSettings = {
      historyTimeslotInMinutes = 5
      HistoryTimeslotInMinutes = 5
      StatusTableEnabled = false
      SuspendedTablesTableEnabled = false
      HistoryTableEnabled = false
      ControlSchema = ""
      FullLoadExceptionTableEnabled = false
    }
    LoopbackPreventionSettings = null
    CharacterSetSettings = null
    FailTaskWhenCleanTaskResourceFailed = false
    ChangeProcessingTuning = {
      StatementCacheSize = 50
      CommitTimeout = 1
      RecoveryTimeout = -1
      BatchApplyPreserveTransaction = true
      BatchApplyTimeoutMin = 1
      BatchSplitSize = 0
      BatchApplyTimeoutMax = 30
      MinTransactionSize = 1000
      MemoryKeepTime = 30
      BatchApplyMemoryLimit = 1024
      MemoryLimitTotal = 2048
    }
    ChangeProcessingDdlHandlingPolicy = {
      HandleSourceTableDropped = true
      HandleSourceTableTruncated = true
      HandleSourceTableAltered = true
    }
    PostProcessingRules = null
    TimestampColumnName = "edl_load_date"
  })

  tags = {
    Name         = "somwf3-raw-full-migration-task"
    Environment  = var.environment
    Pod          = var.pod
    Businessunit = var.businessunit
  }
}




resource "aws_dms_replication_task" "somwf3_raw_cdc_migration" {
  migration_type           = "cdc"
  replication_instance_arn = data.aws_dms_replication_instance.main.replication_instance_arn
  replication_task_id      = "migration-task-esoms-wf3-raw-cdc"
  source_endpoint_arn      = aws_dms_endpoint.esom_wf3_oracle_source_endpoint.endpoint_arn
  target_endpoint_arn      = aws_dms_endpoint.s3_target_endpoint.endpoint_arn
  table_mappings           = local.somwf3_raw_cdc_mappings

  replication_task_settings = jsonencode({
    Logging = {
      EnableLogging = true
      EnableLogContext = true
      LogComponents = [
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TRANSFORMATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_UNLOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "IO" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_LOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "PERFORMANCE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_CAPTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SORTER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "REST_SERVER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "VALIDATOR_EXT" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_APPLY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TASK_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TABLES_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "METADATA_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_FACTORY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMON" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "ADDONS" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "DATA_STRUCTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMUNICATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_TRANSFER" }
      ]
    }
    StreamBufferSettings = {
      StreamBufferCount = 2
      CtrlStreamBufferSizeInMB = 16
      StreamBufferSizeInMB = 16
    }
    ErrorBehavior = {
      FailOnNoTablesCaptured = true
      ApplyErrorUpdatePolicy = "LOG_ERROR"
      FailOnTransactionConsistencyBreached = false
      RecoverableErrorThrottlingMax = 1800
      DataErrorEscalationPolicy = "SUSPEND_TABLE"
      ApplyErrorEscalationCount = 0
      RecoverableErrorStopRetryAfterThrottlingMax = true
      RecoverableErrorThrottling = true
      ApplyErrorFailOnTruncationDdl = false
      DataMaskingErrorPolicy = "STOP_TASK"
      DataTruncationErrorPolicy = "LOG_ERROR"
      ApplyErrorInsertPolicy = "LOG_ERROR"
      EventErrorPolicy = "IGNORE"
      ApplyErrorEscalationPolicy = "LOG_ERROR"
      RecoverableErrorCount = -1
      DataErrorEscalationCount = 0
      TableErrorEscalationPolicy = "STOP_TASK"
      RecoverableErrorInterval = 5
      ApplyErrorDeletePolicy = "IGNORE_RECORD"
      TableErrorEscalationCount = 0
      FullLoadIgnoreConflicts = true
      DataErrorPolicy = "LOG_ERROR"
      TableErrorPolicy = "SUSPEND_TABLE"
    }
    TTSettings = null
    FullLoadSettings = {
      CommitRate = 5000
      StopTaskCachedChangesApplied = false
      StopTaskCachedChangesNotApplied = false
      MaxFullLoadSubTasks = 4
      TransactionConsistencyTimeout = 600
      CreatePkAfterFullLoad = false
      TargetTablePrepMode = "DO_NOTHING"
    }
    TargetMetadata = {
      ParallelApplyBufferSize = 0
      ParallelApplyQueuesPerThread = 0
      ParallelApplyThreads = 0
      TargetSchema = ""
      InlineLobMaxSize = 0
      ParallelLoadQueuesPerThread = 0
      SupportLobs = true
      LobChunkSize = 0
      TaskRecoveryTableEnabled = false
      ParallelLoadThreads = 0
      LobMaxSize = 104448
      BatchApplyEnabled = false
      FullLobMode = false
      LimitedSizeLobMode = true
      LoadMaxFileSize = 0
      ParallelLoadBufferSize = 0
    }
    BeforeImageSettings = null
    ControlTablesSettings = {
      historyTimeslotInMinutes = 5
      HistoryTimeslotInMinutes = 5
      StatusTableEnabled = false
      SuspendedTablesTableEnabled = false
      HistoryTableEnabled = false
      ControlSchema = ""
      FullLoadExceptionTableEnabled = false
    }
    LoopbackPreventionSettings = null
    CharacterSetSettings = null
    FailTaskWhenCleanTaskResourceFailed = false
    ChangeProcessingTuning = {
      StatementCacheSize = 50
      CommitTimeout = 1
      RecoveryTimeout = -1
      BatchApplyPreserveTransaction = true
      BatchApplyTimeoutMin = 1
      BatchSplitSize = 0
      BatchApplyTimeoutMax = 30
      MinTransactionSize = 1000
      MemoryKeepTime = 30
      BatchApplyMemoryLimit = 1024
      MemoryLimitTotal = 2048
    }
    ChangeProcessingDdlHandlingPolicy = {
      HandleSourceTableDropped = true
      HandleSourceTableTruncated = true
      HandleSourceTableAltered = true
    }
    PostProcessingRules = null
    TimestampColumnName = "edl_load_date"
  })

  tags = {
    Name         = "somwf3-raw-cdc-migration-task"
    Environment  = var.environment
    Pod          = var.pod
    Businessunit = var.businessunit
  }
}



resource "aws_dms_replication_task" "somwf3_blob_full_migration" {
  migration_type           = "full-load"
  replication_instance_arn = data.aws_dms_replication_instance.main.replication_instance_arn
  replication_task_id      = "migration-task-esoms-wf3-blob-raw-full"
  source_endpoint_arn      = aws_dms_endpoint.esom_wf3_oracle_source_endpoint.endpoint_arn
  target_endpoint_arn      = aws_dms_endpoint.s3_target_endpoint.endpoint_arn
  table_mappings           = local.somwf3_raw_blob_mappings

  replication_task_settings = jsonencode({
    Logging = {
      EnableLogging = true
      EnableLogContext = true
      LogComponents = [
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TRANSFORMATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_UNLOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "IO" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_LOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "PERFORMANCE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_CAPTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SORTER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "REST_SERVER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "VALIDATOR_EXT" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_APPLY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TASK_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TABLES_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "METADATA_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_FACTORY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMON" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "ADDONS" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "DATA_STRUCTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMUNICATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_TRANSFER" }
      ]
    }
    StreamBufferSettings = {
      StreamBufferCount = 2
      CtrlStreamBufferSizeInMB = 16
      StreamBufferSizeInMB = 16
    }
    ErrorBehavior = {
      FailOnNoTablesCaptured = true
      ApplyErrorUpdatePolicy = "LOG_ERROR"
      FailOnTransactionConsistencyBreached = false
      RecoverableErrorThrottlingMax = 1800
      DataErrorEscalationPolicy = "SUSPEND_TABLE"
      ApplyErrorEscalationCount = 0
      RecoverableErrorStopRetryAfterThrottlingMax = true
      RecoverableErrorThrottling = true
      ApplyErrorFailOnTruncationDdl = false
      DataMaskingErrorPolicy = "STOP_TASK"
      DataTruncationErrorPolicy = "LOG_ERROR"
      ApplyErrorInsertPolicy = "LOG_ERROR"
      EventErrorPolicy = "IGNORE"
      ApplyErrorEscalationPolicy = "LOG_ERROR"
      RecoverableErrorCount = -1
      DataErrorEscalationCount = 0
      TableErrorEscalationPolicy = "STOP_TASK"
      RecoverableErrorInterval = 5
      ApplyErrorDeletePolicy = "IGNORE_RECORD"
      TableErrorEscalationCount = 0
      FullLoadIgnoreConflicts = true
      DataErrorPolicy = "LOG_ERROR"
      TableErrorPolicy = "SUSPEND_TABLE"
    }
    TTSettings = null
    FullLoadSettings = {
      CommitRate = 5000
      StopTaskCachedChangesApplied = false
      StopTaskCachedChangesNotApplied = false
      MaxFullLoadSubTasks = 4
      TransactionConsistencyTimeout = 600
      CreatePkAfterFullLoad = false
      TargetTablePrepMode = "DROP_AND_CREATE"
    }
    TargetMetadata = {
      ParallelApplyBufferSize = 0
      ParallelApplyQueuesPerThread = 0
      ParallelApplyThreads = 0
      TargetSchema = ""
      InlineLobMaxSize = 0
      ParallelLoadQueuesPerThread = 0
      SupportLobs = true
      LobChunkSize = 0
      TaskRecoveryTableEnabled = false
      ParallelLoadThreads = 0
      LobMaxSize = 104448
      BatchApplyEnabled = false
      FullLobMode = false
      LimitedSizeLobMode = true
      LoadMaxFileSize = 0
      ParallelLoadBufferSize = 0
    }
    BeforeImageSettings = null
    ControlTablesSettings = {
      historyTimeslotInMinutes = 5
      HistoryTimeslotInMinutes = 5
      StatusTableEnabled = false
      SuspendedTablesTableEnabled = false
      HistoryTableEnabled = false
      ControlSchema = ""
      FullLoadExceptionTableEnabled = false
    }
    LoopbackPreventionSettings = null
    CharacterSetSettings = null
    FailTaskWhenCleanTaskResourceFailed = false
    ChangeProcessingTuning = {
      StatementCacheSize = 50
      CommitTimeout = 1
      RecoveryTimeout = -1
      BatchApplyPreserveTransaction = true
      BatchApplyTimeoutMin = 1
      BatchSplitSize = 0
      BatchApplyTimeoutMax = 30
      MinTransactionSize = 1000
      MemoryKeepTime = 30
      BatchApplyMemoryLimit = 1024
      MemoryLimitTotal = 2048
    }
    ChangeProcessingDdlHandlingPolicy = {
      HandleSourceTableDropped = true
      HandleSourceTableTruncated = true
      HandleSourceTableAltered = true
    }
    PostProcessingRules = null
    TimestampColumnName = "edl_load_date"
  })

  tags = {
    Name         = "somwf3-raw-full-migration-task"
    Environment  = var.environment
    Pod          = var.pod
    Businessunit = var.businessunit
  }
}

resource "aws_dms_replication_task" "somrbs_non_blob_raw_full_migration" {
  migration_type           = "full-load"
  replication_instance_arn = data.aws_dms_replication_instance.main.replication_instance_arn
  replication_task_id      = "migration-task-esoms-rbs-raw-full"
  source_endpoint_arn      = aws_dms_endpoint.esom_rbs_oracle_source_endpoint.endpoint_arn
  target_endpoint_arn      = aws_dms_endpoint.s3_target_endpoint.endpoint_arn
  table_mappings           = local.somrbs_non_blob_raw_full_mappings

  replication_task_settings = jsonencode({
    Logging = {
      EnableLogging = true
      EnableLogContext = true
      LogComponents = [
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TRANSFORMATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_UNLOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "IO" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_LOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "PERFORMANCE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_CAPTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SORTER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "REST_SERVER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "VALIDATOR_EXT" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_APPLY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TASK_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TABLES_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "METADATA_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_FACTORY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMON" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "ADDONS" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "DATA_STRUCTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMUNICATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_TRANSFER" }
      ]
    }
    StreamBufferSettings = {
      StreamBufferCount = 2
      CtrlStreamBufferSizeInMB = 16
      StreamBufferSizeInMB = 16
    }
    ErrorBehavior = {
      FailOnNoTablesCaptured = true
      ApplyErrorUpdatePolicy = "LOG_ERROR"
      FailOnTransactionConsistencyBreached = false
      RecoverableErrorThrottlingMax = 1800
      DataErrorEscalationPolicy = "SUSPEND_TABLE"
      ApplyErrorEscalationCount = 0
      RecoverableErrorStopRetryAfterThrottlingMax = true
      RecoverableErrorThrottling = true
      ApplyErrorFailOnTruncationDdl = false
      DataMaskingErrorPolicy = "STOP_TASK"
      DataTruncationErrorPolicy = "LOG_ERROR"
      ApplyErrorInsertPolicy = "LOG_ERROR"
      EventErrorPolicy = "IGNORE"
      ApplyErrorEscalationPolicy = "LOG_ERROR"
      RecoverableErrorCount = -1
      DataErrorEscalationCount = 0
      TableErrorEscalationPolicy = "STOP_TASK"
      RecoverableErrorInterval = 5
      ApplyErrorDeletePolicy = "IGNORE_RECORD"
      TableErrorEscalationCount = 0
      FullLoadIgnoreConflicts = true
      DataErrorPolicy = "LOG_ERROR"
      TableErrorPolicy = "SUSPEND_TABLE"
    }
    TTSettings = null
    FullLoadSettings = {
      CommitRate = 5000
      StopTaskCachedChangesApplied = false
      StopTaskCachedChangesNotApplied = false
      MaxFullLoadSubTasks = 4
      TransactionConsistencyTimeout = 600
      CreatePkAfterFullLoad = false
      TargetTablePrepMode = "DROP_AND_CREATE"
    }
    TargetMetadata = {
      ParallelApplyBufferSize = 0
      ParallelApplyQueuesPerThread = 0
      ParallelApplyThreads = 0
      TargetSchema = ""
      InlineLobMaxSize = 0
      ParallelLoadQueuesPerThread = 0
      SupportLobs = true
      LobChunkSize = 0
      TaskRecoveryTableEnabled = false
      ParallelLoadThreads = 0
      LobMaxSize = 32
      BatchApplyEnabled = false
      FullLobMode = false
      LimitedSizeLobMode = true
      LoadMaxFileSize = 0
      ParallelLoadBufferSize = 0
    }
    BeforeImageSettings = null
    ControlTablesSettings = {
      historyTimeslotInMinutes = 5
      HistoryTimeslotInMinutes = 5
      StatusTableEnabled = false
      SuspendedTablesTableEnabled = false
      HistoryTableEnabled = false
      ControlSchema = ""
      FullLoadExceptionTableEnabled = false
    }
    LoopbackPreventionSettings = null
    CharacterSetSettings = null
    FailTaskWhenCleanTaskResourceFailed = false
    ChangeProcessingTuning = {
      StatementCacheSize = 50
      CommitTimeout = 1
      RecoveryTimeout = -1
      BatchApplyPreserveTransaction = true
      BatchApplyTimeoutMin = 1
      BatchSplitSize = 0
      BatchApplyTimeoutMax = 30
      MinTransactionSize = 1000
      MemoryKeepTime = 30
      BatchApplyMemoryLimit = 1024
      MemoryLimitTotal = 2048
    }
    ChangeProcessingDdlHandlingPolicy = {
      HandleSourceTableDropped = true
      HandleSourceTableTruncated = true
      HandleSourceTableAltered = true
    }
    PostProcessingRules = null
    TimestampColumnName = "edl_load_date"
  })

  tags = {
    Name         = "somrbs-raw-full-migration-task"
    Environment  = var.environment
    Pod          = var.pod
    Businessunit = var.businessunit
  }
}




resource "aws_dms_replication_task" "somrbs_raw_cdc_migration" {
  migration_type           = "cdc"
  replication_instance_arn = data.aws_dms_replication_instance.main.replication_instance_arn
  replication_task_id      = "migration-task-esoms-rbs-raw-cdc"
  source_endpoint_arn      = aws_dms_endpoint.esom_rbs_oracle_source_endpoint.endpoint_arn
  target_endpoint_arn      = aws_dms_endpoint.s3_target_endpoint.endpoint_arn
  table_mappings           = local.somrbs_raw_cdc_mappings

  replication_task_settings = jsonencode({
    Logging = {
      EnableLogging = true
      EnableLogContext = true
      LogComponents = [
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TRANSFORMATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_UNLOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "IO" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_LOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "PERFORMANCE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_CAPTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SORTER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "REST_SERVER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "VALIDATOR_EXT" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_APPLY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TASK_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TABLES_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "METADATA_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_FACTORY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMON" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "ADDONS" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "DATA_STRUCTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMUNICATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_TRANSFER" }
      ]
    }
    StreamBufferSettings = {
      StreamBufferCount = 2
      CtrlStreamBufferSizeInMB = 16
      StreamBufferSizeInMB = 16
    }
    ErrorBehavior = {
      FailOnNoTablesCaptured = true
      ApplyErrorUpdatePolicy = "LOG_ERROR"
      FailOnTransactionConsistencyBreached = false
      RecoverableErrorThrottlingMax = 1800
      DataErrorEscalationPolicy = "SUSPEND_TABLE"
      ApplyErrorEscalationCount = 0
      RecoverableErrorStopRetryAfterThrottlingMax = true
      RecoverableErrorThrottling = true
      ApplyErrorFailOnTruncationDdl = false
      DataMaskingErrorPolicy = "STOP_TASK"
      DataTruncationErrorPolicy = "LOG_ERROR"
      ApplyErrorInsertPolicy = "LOG_ERROR"
      EventErrorPolicy = "IGNORE"
      ApplyErrorEscalationPolicy = "LOG_ERROR"
      RecoverableErrorCount = -1
      DataErrorEscalationCount = 0
      TableErrorEscalationPolicy = "STOP_TASK"
      RecoverableErrorInterval = 5
      ApplyErrorDeletePolicy = "IGNORE_RECORD"
      TableErrorEscalationCount = 0
      FullLoadIgnoreConflicts = true
      DataErrorPolicy = "LOG_ERROR"
      TableErrorPolicy = "SUSPEND_TABLE"
    }
    TTSettings = null
    FullLoadSettings = {
      CommitRate = 5000
      StopTaskCachedChangesApplied = false
      StopTaskCachedChangesNotApplied = false
      MaxFullLoadSubTasks = 4
      TransactionConsistencyTimeout = 600
      CreatePkAfterFullLoad = false
      TargetTablePrepMode = "DO_NOTHING"
    }
    TargetMetadata = {
      ParallelApplyBufferSize = 0
      ParallelApplyQueuesPerThread = 0
      ParallelApplyThreads = 0
      TargetSchema = ""
      InlineLobMaxSize = 0
      ParallelLoadQueuesPerThread = 0
      SupportLobs = true
      LobChunkSize = 0
      TaskRecoveryTableEnabled = false
      ParallelLoadThreads = 0
      LobMaxSize = 104448
      BatchApplyEnabled = false
      FullLobMode = false
      LimitedSizeLobMode = true
      LoadMaxFileSize = 0
      ParallelLoadBufferSize = 0
    }
    BeforeImageSettings = null
    ControlTablesSettings = {
      historyTimeslotInMinutes = 5
      HistoryTimeslotInMinutes = 5
      StatusTableEnabled = false
      SuspendedTablesTableEnabled = false
      HistoryTableEnabled = false
      ControlSchema = ""
      FullLoadExceptionTableEnabled = false
    }
    LoopbackPreventionSettings = null
    CharacterSetSettings = null
    FailTaskWhenCleanTaskResourceFailed = false
    ChangeProcessingTuning = {
      StatementCacheSize = 50
      CommitTimeout = 1
      RecoveryTimeout = -1
      BatchApplyPreserveTransaction = true
      BatchApplyTimeoutMin = 1
      BatchSplitSize = 0
      BatchApplyTimeoutMax = 30
      MinTransactionSize = 1000
      MemoryKeepTime = 30
      BatchApplyMemoryLimit = 1024
      MemoryLimitTotal = 2048
    }
    ChangeProcessingDdlHandlingPolicy = {
      HandleSourceTableDropped = true
      HandleSourceTableTruncated = true
      HandleSourceTableAltered = true
    }
    PostProcessingRules = null
    TimestampColumnName = "edl_load_date"
  })

  tags = {
    Name         = "somrbs-raw-cdc-migration-task"
    Environment  = var.environment
    Pod          = var.pod
    Businessunit = var.businessunit
  }
}



resource "aws_dms_replication_task" "somrbs_blob_full_migration" {
  migration_type           = "full-load"
  replication_instance_arn = data.aws_dms_replication_instance.main.replication_instance_arn
  replication_task_id      = "migration-task-esoms-rbs-blob-raw-full"
  source_endpoint_arn      = aws_dms_endpoint.esom_rbs_oracle_source_endpoint.endpoint_arn
  target_endpoint_arn      = aws_dms_endpoint.s3_target_endpoint.endpoint_arn
  table_mappings           = local.somrbs_raw_blob_mappings

  replication_task_settings = jsonencode({
    Logging = {
      EnableLogging = true
      EnableLogContext = true
      LogComponents = [
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TRANSFORMATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_UNLOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "IO" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_LOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "PERFORMANCE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_CAPTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SORTER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "REST_SERVER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "VALIDATOR_EXT" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_APPLY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TASK_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TABLES_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "METADATA_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_FACTORY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMON" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "ADDONS" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "DATA_STRUCTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMUNICATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_TRANSFER" }
      ]
    }
    StreamBufferSettings = {
      StreamBufferCount = 2
      CtrlStreamBufferSizeInMB = 16
      StreamBufferSizeInMB = 16
    }
    ErrorBehavior = {
      FailOnNoTablesCaptured = true
      ApplyErrorUpdatePolicy = "LOG_ERROR"
      FailOnTransactionConsistencyBreached = false
      RecoverableErrorThrottlingMax = 1800
      DataErrorEscalationPolicy = "SUSPEND_TABLE"
      ApplyErrorEscalationCount = 0
      RecoverableErrorStopRetryAfterThrottlingMax = true
      RecoverableErrorThrottling = true
      ApplyErrorFailOnTruncationDdl = false
      DataMaskingErrorPolicy = "STOP_TASK"
      DataTruncationErrorPolicy = "LOG_ERROR"
      ApplyErrorInsertPolicy = "LOG_ERROR"
      EventErrorPolicy = "IGNORE"
      ApplyErrorEscalationPolicy = "LOG_ERROR"
      RecoverableErrorCount = -1
      DataErrorEscalationCount = 0
      TableErrorEscalationPolicy = "STOP_TASK"
      RecoverableErrorInterval = 5
      ApplyErrorDeletePolicy = "IGNORE_RECORD"
      TableErrorEscalationCount = 0
      FullLoadIgnoreConflicts = true
      DataErrorPolicy = "LOG_ERROR"
      TableErrorPolicy = "SUSPEND_TABLE"
    }
    TTSettings = null
    FullLoadSettings = {
      CommitRate = 5000
      StopTaskCachedChangesApplied = false
      StopTaskCachedChangesNotApplied = false
      MaxFullLoadSubTasks = 4
      TransactionConsistencyTimeout = 600
      CreatePkAfterFullLoad = false
      TargetTablePrepMode = "DROP_AND_CREATE"
    }
    TargetMetadata = {
      ParallelApplyBufferSize = 0
      ParallelApplyQueuesPerThread = 0
      ParallelApplyThreads = 0
      TargetSchema = ""
      InlineLobMaxSize = 0
      ParallelLoadQueuesPerThread = 0
      SupportLobs = true
      LobChunkSize = 0
      TaskRecoveryTableEnabled = false
      ParallelLoadThreads = 0
      LobMaxSize = 104448
      BatchApplyEnabled = false
      FullLobMode = false
      LimitedSizeLobMode = true
      LoadMaxFileSize = 0
      ParallelLoadBufferSize = 0
    }
    BeforeImageSettings = null
    ControlTablesSettings = {
      historyTimeslotInMinutes = 5
      HistoryTimeslotInMinutes = 5
      StatusTableEnabled = false
      SuspendedTablesTableEnabled = false
      HistoryTableEnabled = false
      ControlSchema = ""
      FullLoadExceptionTableEnabled = false
    }
    LoopbackPreventionSettings = null
    CharacterSetSettings = null
    FailTaskWhenCleanTaskResourceFailed = false
    ChangeProcessingTuning = {
      StatementCacheSize = 50
      CommitTimeout = 1
      RecoveryTimeout = -1
      BatchApplyPreserveTransaction = true
      BatchApplyTimeoutMin = 1
      BatchSplitSize = 0
      BatchApplyTimeoutMax = 30
      MinTransactionSize = 1000
      MemoryKeepTime = 30
      BatchApplyMemoryLimit = 1024
      MemoryLimitTotal = 2048
    }
    ChangeProcessingDdlHandlingPolicy = {
      HandleSourceTableDropped = true
      HandleSourceTableTruncated = true
      HandleSourceTableAltered = true
    }
    PostProcessingRules = null
    TimestampColumnName = "edl_load_date"
  })

  tags = {
    Name         = "somrbs-raw-full-migration-task"
    Environment  = var.environment
    Pod          = var.pod
    Businessunit = var.businessunit
  }
}

resource "aws_dms_replication_task" "somggn_non_blob_raw_full_migration" {
  migration_type           = "full-load"
  replication_instance_arn = data.aws_dms_replication_instance.main.replication_instance_arn
  replication_task_id      = "migration-task-esoms-ggn-raw-full"
  source_endpoint_arn      = aws_dms_endpoint.esom_ggn_oracle_source_endpoint.endpoint_arn
  target_endpoint_arn      = aws_dms_endpoint.s3_target_endpoint.endpoint_arn
  table_mappings           = local.somggn_non_blob_raw_full_mappings

  replication_task_settings = jsonencode({
    Logging = {
      EnableLogging = true
      EnableLogContext = true
      LogComponents = [
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TRANSFORMATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_UNLOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "IO" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_LOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "PERFORMANCE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_CAPTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SORTER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "REST_SERVER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "VALIDATOR_EXT" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_APPLY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TASK_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TABLES_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "METADATA_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_FACTORY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMON" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "ADDONS" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "DATA_STRUCTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMUNICATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_TRANSFER" }
      ]
    }
    StreamBufferSettings = {
      StreamBufferCount = 2
      CtrlStreamBufferSizeInMB = 16
      StreamBufferSizeInMB = 16
    }
    ErrorBehavior = {
      FailOnNoTablesCaptured = true
      ApplyErrorUpdatePolicy = "LOG_ERROR"
      FailOnTransactionConsistencyBreached = false
      RecoverableErrorThrottlingMax = 1800
      DataErrorEscalationPolicy = "SUSPEND_TABLE"
      ApplyErrorEscalationCount = 0
      RecoverableErrorStopRetryAfterThrottlingMax = true
      RecoverableErrorThrottling = true
      ApplyErrorFailOnTruncationDdl = false
      DataMaskingErrorPolicy = "STOP_TASK"
      DataTruncationErrorPolicy = "LOG_ERROR"
      ApplyErrorInsertPolicy = "LOG_ERROR"
      EventErrorPolicy = "IGNORE"
      ApplyErrorEscalationPolicy = "LOG_ERROR"
      RecoverableErrorCount = -1
      DataErrorEscalationCount = 0
      TableErrorEscalationPolicy = "STOP_TASK"
      RecoverableErrorInterval = 5
      ApplyErrorDeletePolicy = "IGNORE_RECORD"
      TableErrorEscalationCount = 0
      FullLoadIgnoreConflicts = true
      DataErrorPolicy = "LOG_ERROR"
      TableErrorPolicy = "SUSPEND_TABLE"
    }
    TTSettings = null
    FullLoadSettings = {
      CommitRate = 5000
      StopTaskCachedChangesApplied = false
      StopTaskCachedChangesNotApplied = false
      MaxFullLoadSubTasks = 4
      TransactionConsistencyTimeout = 600
      CreatePkAfterFullLoad = false
      TargetTablePrepMode = "DROP_AND_CREATE"
    }
    TargetMetadata = {
      ParallelApplyBufferSize = 0
      ParallelApplyQueuesPerThread = 0
      ParallelApplyThreads = 0
      TargetSchema = ""
      InlineLobMaxSize = 0
      ParallelLoadQueuesPerThread = 0
      SupportLobs = true
      LobChunkSize = 0
      TaskRecoveryTableEnabled = false
      ParallelLoadThreads = 0
      LobMaxSize = 32
      BatchApplyEnabled = false
      FullLobMode = false
      LimitedSizeLobMode = true
      LoadMaxFileSize = 0
      ParallelLoadBufferSize = 0
    }
    BeforeImageSettings = null
    ControlTablesSettings = {
      historyTimeslotInMinutes = 5
      HistoryTimeslotInMinutes = 5
      StatusTableEnabled = false
      SuspendedTablesTableEnabled = false
      HistoryTableEnabled = false
      ControlSchema = ""
      FullLoadExceptionTableEnabled = false
    }
    LoopbackPreventionSettings = null
    CharacterSetSettings = null
    FailTaskWhenCleanTaskResourceFailed = false
    ChangeProcessingTuning = {
      StatementCacheSize = 50
      CommitTimeout = 1
      RecoveryTimeout = -1
      BatchApplyPreserveTransaction = true
      BatchApplyTimeoutMin = 1
      BatchSplitSize = 0
      BatchApplyTimeoutMax = 30
      MinTransactionSize = 1000
      MemoryKeepTime = 30
      BatchApplyMemoryLimit = 1024
      MemoryLimitTotal = 2048
    }
    ChangeProcessingDdlHandlingPolicy = {
      HandleSourceTableDropped = true
      HandleSourceTableTruncated = true
      HandleSourceTableAltered = true
    }
    PostProcessingRules = null
    TimestampColumnName = "edl_load_date"
  })

  tags = {
    Name         = "somggn-raw-full-migration-task"
    Environment  = var.environment
    Pod          = var.pod
    Businessunit = var.businessunit
  }
}




resource "aws_dms_replication_task" "somggn_raw_cdc_migration" {
  migration_type           = "cdc"
  replication_instance_arn = data.aws_dms_replication_instance.main.replication_instance_arn
  replication_task_id      = "migration-task-esoms-ggn-raw-cdc"
  source_endpoint_arn      = aws_dms_endpoint.esom_ggn_oracle_source_endpoint.endpoint_arn
  target_endpoint_arn      = aws_dms_endpoint.s3_target_endpoint.endpoint_arn
  table_mappings           = local.somwggn_raw_cdc_mappings

  replication_task_settings = jsonencode({
    Logging = {
      EnableLogging = true
      EnableLogContext = true
      LogComponents = [
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TRANSFORMATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_UNLOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "IO" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_LOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "PERFORMANCE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_CAPTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SORTER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "REST_SERVER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "VALIDATOR_EXT" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_APPLY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TASK_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TABLES_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "METADATA_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_FACTORY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMON" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "ADDONS" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "DATA_STRUCTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMUNICATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_TRANSFER" }
      ]
    }
    StreamBufferSettings = {
      StreamBufferCount = 2
      CtrlStreamBufferSizeInMB = 16
      StreamBufferSizeInMB = 16
    }
    ErrorBehavior = {
      FailOnNoTablesCaptured = true
      ApplyErrorUpdatePolicy = "LOG_ERROR"
      FailOnTransactionConsistencyBreached = false
      RecoverableErrorThrottlingMax = 1800
      DataErrorEscalationPolicy = "SUSPEND_TABLE"
      ApplyErrorEscalationCount = 0
      RecoverableErrorStopRetryAfterThrottlingMax = true
      RecoverableErrorThrottling = true
      ApplyErrorFailOnTruncationDdl = false
      DataMaskingErrorPolicy = "STOP_TASK"
      DataTruncationErrorPolicy = "LOG_ERROR"
      ApplyErrorInsertPolicy = "LOG_ERROR"
      EventErrorPolicy = "IGNORE"
      ApplyErrorEscalationPolicy = "LOG_ERROR"
      RecoverableErrorCount = -1
      DataErrorEscalationCount = 0
      TableErrorEscalationPolicy = "STOP_TASK"
      RecoverableErrorInterval = 5
      ApplyErrorDeletePolicy = "IGNORE_RECORD"
      TableErrorEscalationCount = 0
      FullLoadIgnoreConflicts = true
      DataErrorPolicy = "LOG_ERROR"
      TableErrorPolicy = "SUSPEND_TABLE"
    }
    TTSettings = null
    FullLoadSettings = {
      CommitRate = 5000
      StopTaskCachedChangesApplied = false
      StopTaskCachedChangesNotApplied = false
      MaxFullLoadSubTasks = 4
      TransactionConsistencyTimeout = 600
      CreatePkAfterFullLoad = false
      TargetTablePrepMode = "DO_NOTHING"
    }
    TargetMetadata = {
      ParallelApplyBufferSize = 0
      ParallelApplyQueuesPerThread = 0
      ParallelApplyThreads = 0
      TargetSchema = ""
      InlineLobMaxSize = 0
      ParallelLoadQueuesPerThread = 0
      SupportLobs = true
      LobChunkSize = 0
      TaskRecoveryTableEnabled = false
      ParallelLoadThreads = 0
      LobMaxSize = 104448
      BatchApplyEnabled = false
      FullLobMode = false
      LimitedSizeLobMode = true
      LoadMaxFileSize = 0
      ParallelLoadBufferSize = 0
    }
    BeforeImageSettings = null
    ControlTablesSettings = {
      historyTimeslotInMinutes = 5
      HistoryTimeslotInMinutes = 5
      StatusTableEnabled = false
      SuspendedTablesTableEnabled = false
      HistoryTableEnabled = false
      ControlSchema = ""
      FullLoadExceptionTableEnabled = false
    }
    LoopbackPreventionSettings = null
    CharacterSetSettings = null
    FailTaskWhenCleanTaskResourceFailed = false
    ChangeProcessingTuning = {
      StatementCacheSize = 50
      CommitTimeout = 1
      RecoveryTimeout = -1
      BatchApplyPreserveTransaction = true
      BatchApplyTimeoutMin = 1
      BatchSplitSize = 0
      BatchApplyTimeoutMax = 30
      MinTransactionSize = 1000
      MemoryKeepTime = 30
      BatchApplyMemoryLimit = 1024
      MemoryLimitTotal = 2048
    }
    ChangeProcessingDdlHandlingPolicy = {
      HandleSourceTableDropped = true
      HandleSourceTableTruncated = true
      HandleSourceTableAltered = true
    }
    PostProcessingRules = null
    TimestampColumnName = "edl_load_date"
  })

  tags = {
    Name         = "somggn-raw-cdc-migration-task"
    Environment  = var.environment
    Pod          = var.pod
    Businessunit = var.businessunit
  }
}



resource "aws_dms_replication_task" "somwggn_blob_full_migration" {
  migration_type           = "full-load"
  replication_instance_arn = data.aws_dms_replication_instance.main.replication_instance_arn
  replication_task_id      = "migration-task-esoms-ggn-blob-raw-full"
  source_endpoint_arn      = aws_dms_endpoint.esom_ggn_oracle_source_endpoint.endpoint_arn
  target_endpoint_arn      = aws_dms_endpoint.s3_target_endpoint.endpoint_arn
  table_mappings           = local.somggn_raw_blob_mappings

  replication_task_settings = jsonencode({
    Logging = {
      EnableLogging = true
      EnableLogContext = true
      LogComponents = [
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TRANSFORMATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_UNLOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "IO" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_LOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "PERFORMANCE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_CAPTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SORTER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "REST_SERVER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "VALIDATOR_EXT" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_APPLY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TASK_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TABLES_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "METADATA_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_FACTORY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMON" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "ADDONS" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "DATA_STRUCTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMUNICATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_TRANSFER" }
      ]
    }
    StreamBufferSettings = {
      StreamBufferCount = 2
      CtrlStreamBufferSizeInMB = 16
      StreamBufferSizeInMB = 16
    }
    ErrorBehavior = {
      FailOnNoTablesCaptured = true
      ApplyErrorUpdatePolicy = "LOG_ERROR"
      FailOnTransactionConsistencyBreached = false
      RecoverableErrorThrottlingMax = 1800
      DataErrorEscalationPolicy = "SUSPEND_TABLE"
      ApplyErrorEscalationCount = 0
      RecoverableErrorStopRetryAfterThrottlingMax = true
      RecoverableErrorThrottling = true
      ApplyErrorFailOnTruncationDdl = false
      DataMaskingErrorPolicy = "STOP_TASK"
      DataTruncationErrorPolicy = "LOG_ERROR"
      ApplyErrorInsertPolicy = "LOG_ERROR"
      EventErrorPolicy = "IGNORE"
      ApplyErrorEscalationPolicy = "LOG_ERROR"
      RecoverableErrorCount = -1
      DataErrorEscalationCount = 0
      TableErrorEscalationPolicy = "STOP_TASK"
      RecoverableErrorInterval = 5
      ApplyErrorDeletePolicy = "IGNORE_RECORD"
      TableErrorEscalationCount = 0
      FullLoadIgnoreConflicts = true
      DataErrorPolicy = "LOG_ERROR"
      TableErrorPolicy = "SUSPEND_TABLE"
    }
    TTSettings = null
    FullLoadSettings = {
      CommitRate = 5000
      StopTaskCachedChangesApplied = false
      StopTaskCachedChangesNotApplied = false
      MaxFullLoadSubTasks = 4
      TransactionConsistencyTimeout = 600
      CreatePkAfterFullLoad = false
      TargetTablePrepMode = "DROP_AND_CREATE"
    }
    TargetMetadata = {
      ParallelApplyBufferSize = 0
      ParallelApplyQueuesPerThread = 0
      ParallelApplyThreads = 0
      TargetSchema = ""
      InlineLobMaxSize = 0
      ParallelLoadQueuesPerThread = 0
      SupportLobs = true
      LobChunkSize = 0
      TaskRecoveryTableEnabled = false
      ParallelLoadThreads = 0
      LobMaxSize = 104448
      BatchApplyEnabled = false
      FullLobMode = false
      LimitedSizeLobMode = true
      LoadMaxFileSize = 0
      ParallelLoadBufferSize = 0
    }
    BeforeImageSettings = null
    ControlTablesSettings = {
      historyTimeslotInMinutes = 5
      HistoryTimeslotInMinutes = 5
      StatusTableEnabled = false
      SuspendedTablesTableEnabled = false
      HistoryTableEnabled = false
      ControlSchema = ""
      FullLoadExceptionTableEnabled = false
    }
    LoopbackPreventionSettings = null
    CharacterSetSettings = null
    FailTaskWhenCleanTaskResourceFailed = false
    ChangeProcessingTuning = {
      StatementCacheSize = 50
      CommitTimeout = 1
      RecoveryTimeout = -1
      BatchApplyPreserveTransaction = true
      BatchApplyTimeoutMin = 1
      BatchSplitSize = 0
      BatchApplyTimeoutMax = 30
      MinTransactionSize = 1000
      MemoryKeepTime = 30
      BatchApplyMemoryLimit = 1024
      MemoryLimitTotal = 2048
    }
    ChangeProcessingDdlHandlingPolicy = {
      HandleSourceTableDropped = true
      HandleSourceTableTruncated = true
      HandleSourceTableAltered = true
    }
    PostProcessingRules = null
    TimestampColumnName = "edl_load_date"
  })

  tags = {
    Name         = "somggn-raw-full-migration-task"
    Environment  = var.environment
    Pod          = var.pod
    Businessunit = var.businessunit
  }
}

resource "aws_dms_replication_task" "somano_non_blob_raw_full_migration" {
  migration_type           = "full-load"
  replication_instance_arn = data.aws_dms_replication_instance.main.replication_instance_arn
  replication_task_id      = "migration-task-esoms-ano-raw-full"
  source_endpoint_arn      = aws_dms_endpoint.esom_ano_oracle_source_endpoint.endpoint_arn
  target_endpoint_arn      = aws_dms_endpoint.s3_target_endpoint.endpoint_arn
  table_mappings           = local.somano_non_blob_raw_full_mappings

  replication_task_settings = jsonencode({
    Logging = {
      EnableLogging = true
      EnableLogContext = true
      LogComponents = [
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TRANSFORMATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_UNLOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "IO" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_LOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "PERFORMANCE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_CAPTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SORTER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "REST_SERVER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "VALIDATOR_EXT" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_APPLY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TASK_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TABLES_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "METADATA_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_FACTORY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMON" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "ADDONS" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "DATA_STRUCTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMUNICATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_TRANSFER" }
      ]
    }
    StreamBufferSettings = {
      StreamBufferCount = 2
      CtrlStreamBufferSizeInMB = 16
      StreamBufferSizeInMB = 16
    }
    ErrorBehavior = {
      FailOnNoTablesCaptured = true
      ApplyErrorUpdatePolicy = "LOG_ERROR"
      FailOnTransactionConsistencyBreached = false
      RecoverableErrorThrottlingMax = 1800
      DataErrorEscalationPolicy = "SUSPEND_TABLE"
      ApplyErrorEscalationCount = 0
      RecoverableErrorStopRetryAfterThrottlingMax = true
      RecoverableErrorThrottling = true
      ApplyErrorFailOnTruncationDdl = false
      DataMaskingErrorPolicy = "STOP_TASK"
      DataTruncationErrorPolicy = "LOG_ERROR"
      ApplyErrorInsertPolicy = "LOG_ERROR"
      EventErrorPolicy = "IGNORE"
      ApplyErrorEscalationPolicy = "LOG_ERROR"
      RecoverableErrorCount = -1
      DataErrorEscalationCount = 0
      TableErrorEscalationPolicy = "STOP_TASK"
      RecoverableErrorInterval = 5
      ApplyErrorDeletePolicy = "IGNORE_RECORD"
      TableErrorEscalationCount = 0
      FullLoadIgnoreConflicts = true
      DataErrorPolicy = "LOG_ERROR"
      TableErrorPolicy = "SUSPEND_TABLE"
    }
    TTSettings = null
    FullLoadSettings = {
      CommitRate = 5000
      StopTaskCachedChangesApplied = false
      StopTaskCachedChangesNotApplied = false
      MaxFullLoadSubTasks = 4
      TransactionConsistencyTimeout = 600
      CreatePkAfterFullLoad = false
      TargetTablePrepMode = "DROP_AND_CREATE"
    }
    TargetMetadata = {
      ParallelApplyBufferSize = 0
      ParallelApplyQueuesPerThread = 0
      ParallelApplyThreads = 0
      TargetSchema = ""
      InlineLobMaxSize = 0
      ParallelLoadQueuesPerThread = 0
      SupportLobs = true
      LobChunkSize = 0
      TaskRecoveryTableEnabled = false
      ParallelLoadThreads = 0
      LobMaxSize = 32
      BatchApplyEnabled = false
      FullLobMode = false
      LimitedSizeLobMode = true
      LoadMaxFileSize = 0
      ParallelLoadBufferSize = 0
    }
    BeforeImageSettings = null
    ControlTablesSettings = {
      historyTimeslotInMinutes = 5
      HistoryTimeslotInMinutes = 5
      StatusTableEnabled = false
      SuspendedTablesTableEnabled = false
      HistoryTableEnabled = false
      ControlSchema = ""
      FullLoadExceptionTableEnabled = false
    }
    LoopbackPreventionSettings = null
    CharacterSetSettings = null
    FailTaskWhenCleanTaskResourceFailed = false
    ChangeProcessingTuning = {
      StatementCacheSize = 50
      CommitTimeout = 1
      RecoveryTimeout = -1
      BatchApplyPreserveTransaction = true
      BatchApplyTimeoutMin = 1
      BatchSplitSize = 0
      BatchApplyTimeoutMax = 30
      MinTransactionSize = 1000
      MemoryKeepTime = 30
      BatchApplyMemoryLimit = 1024
      MemoryLimitTotal = 2048
    }
    ChangeProcessingDdlHandlingPolicy = {
      HandleSourceTableDropped = true
      HandleSourceTableTruncated = true
      HandleSourceTableAltered = true
    }
    PostProcessingRules = null
    TimestampColumnName = "edl_load_date"
  })

  tags = {
    Name         = "somano-raw-full-migration-task"
    Environment  = var.environment
    Pod          = var.pod
    Businessunit = var.businessunit
  }
}




resource "aws_dms_replication_task" "somano_raw_cdc_migration" {
  migration_type           = "cdc"
  replication_instance_arn = data.aws_dms_replication_instance.main.replication_instance_arn
  replication_task_id      = "migration-task-esoms-ano-raw-cdc"
  source_endpoint_arn      = aws_dms_endpoint.esom_ano_oracle_source_endpoint.endpoint_arn
  target_endpoint_arn      = aws_dms_endpoint.s3_target_endpoint.endpoint_arn
  table_mappings           = local.somwano_raw_cdc_mappings

  replication_task_settings = jsonencode({
    Logging = {
      EnableLogging = true
      EnableLogContext = true
      LogComponents = [
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TRANSFORMATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_UNLOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "IO" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_LOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "PERFORMANCE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_CAPTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SORTER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "REST_SERVER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "VALIDATOR_EXT" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_APPLY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TASK_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TABLES_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "METADATA_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_FACTORY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMON" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "ADDONS" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "DATA_STRUCTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMUNICATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_TRANSFER" }
      ]
    }
    StreamBufferSettings = {
      StreamBufferCount = 2
      CtrlStreamBufferSizeInMB = 16
      StreamBufferSizeInMB = 16
    }
    ErrorBehavior = {
      FailOnNoTablesCaptured = true
      ApplyErrorUpdatePolicy = "LOG_ERROR"
      FailOnTransactionConsistencyBreached = false
      RecoverableErrorThrottlingMax = 1800
      DataErrorEscalationPolicy = "SUSPEND_TABLE"
      ApplyErrorEscalationCount = 0
      RecoverableErrorStopRetryAfterThrottlingMax = true
      RecoverableErrorThrottling = true
      ApplyErrorFailOnTruncationDdl = false
      DataMaskingErrorPolicy = "STOP_TASK"
      DataTruncationErrorPolicy = "LOG_ERROR"
      ApplyErrorInsertPolicy = "LOG_ERROR"
      EventErrorPolicy = "IGNORE"
      ApplyErrorEscalationPolicy = "LOG_ERROR"
      RecoverableErrorCount = -1
      DataErrorEscalationCount = 0
      TableErrorEscalationPolicy = "STOP_TASK"
      RecoverableErrorInterval = 5
      ApplyErrorDeletePolicy = "IGNORE_RECORD"
      TableErrorEscalationCount = 0
      FullLoadIgnoreConflicts = true
      DataErrorPolicy = "LOG_ERROR"
      TableErrorPolicy = "SUSPEND_TABLE"
    }
    TTSettings = null
    FullLoadSettings = {
      CommitRate = 5000
      StopTaskCachedChangesApplied = false
      StopTaskCachedChangesNotApplied = false
      MaxFullLoadSubTasks = 4
      TransactionConsistencyTimeout = 600
      CreatePkAfterFullLoad = false
      TargetTablePrepMode = "DO_NOTHING"
    }
    TargetMetadata = {
      ParallelApplyBufferSize = 0
      ParallelApplyQueuesPerThread = 0
      ParallelApplyThreads = 0
      TargetSchema = ""
      InlineLobMaxSize = 0
      ParallelLoadQueuesPerThread = 0
      SupportLobs = true
      LobChunkSize = 0
      TaskRecoveryTableEnabled = false
      ParallelLoadThreads = 0
      LobMaxSize = 104448
      BatchApplyEnabled = false
      FullLobMode = false
      LimitedSizeLobMode = true
      LoadMaxFileSize = 0
      ParallelLoadBufferSize = 0
    }
    BeforeImageSettings = null
    ControlTablesSettings = {
      historyTimeslotInMinutes = 5
      HistoryTimeslotInMinutes = 5
      StatusTableEnabled = false
      SuspendedTablesTableEnabled = false
      HistoryTableEnabled = false
      ControlSchema = ""
      FullLoadExceptionTableEnabled = false
    }
    LoopbackPreventionSettings = null
    CharacterSetSettings = null
    FailTaskWhenCleanTaskResourceFailed = false
    ChangeProcessingTuning = {
      StatementCacheSize = 50
      CommitTimeout = 1
      RecoveryTimeout = -1
      BatchApplyPreserveTransaction = true
      BatchApplyTimeoutMin = 1
      BatchSplitSize = 0
      BatchApplyTimeoutMax = 30
      MinTransactionSize = 1000
      MemoryKeepTime = 30
      BatchApplyMemoryLimit = 1024
      MemoryLimitTotal = 2048
    }
    ChangeProcessingDdlHandlingPolicy = {
      HandleSourceTableDropped = true
      HandleSourceTableTruncated = true
      HandleSourceTableAltered = true
    }
    PostProcessingRules = null
    TimestampColumnName = "edl_load_date"
  })

  tags = {
    Name         = "somano-raw-cdc-migration-task"
    Environment  = var.environment
    Pod          = var.pod
    Businessunit = var.businessunit
  }
}



resource "aws_dms_replication_task" "somwano_blob_full_migration" {
  migration_type           = "full-load"
  replication_instance_arn = data.aws_dms_replication_instance.main.replication_instance_arn
  replication_task_id      = "migration-task-esoms-ano-blob-raw-full"
  source_endpoint_arn      = aws_dms_endpoint.esom_ano_oracle_source_endpoint.endpoint_arn
  target_endpoint_arn      = aws_dms_endpoint.s3_target_endpoint.endpoint_arn
  table_mappings           = local.somano_raw_blob_mappings

  replication_task_settings = jsonencode({
    Logging = {
      EnableLogging = true
      EnableLogContext = true
      LogComponents = [
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TRANSFORMATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_UNLOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "IO" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_LOAD" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "PERFORMANCE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SOURCE_CAPTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "SORTER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "REST_SERVER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "VALIDATOR_EXT" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TARGET_APPLY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TASK_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "TABLES_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "METADATA_MANAGER" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_FACTORY" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMON" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "ADDONS" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "DATA_STRUCTURE" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "COMMUNICATION" },
        { Severity = "LOGGER_SEVERITY_DEFAULT", Id = "FILE_TRANSFER" }
      ]
    }
    StreamBufferSettings = {
      StreamBufferCount = 2
      CtrlStreamBufferSizeInMB = 16
      StreamBufferSizeInMB = 16
    }
    ErrorBehavior = {
      FailOnNoTablesCaptured = true
      ApplyErrorUpdatePolicy = "LOG_ERROR"
      FailOnTransactionConsistencyBreached = false
      RecoverableErrorThrottlingMax = 1800
      DataErrorEscalationPolicy = "SUSPEND_TABLE"
      ApplyErrorEscalationCount = 0
      RecoverableErrorStopRetryAfterThrottlingMax = true
      RecoverableErrorThrottling = true
      ApplyErrorFailOnTruncationDdl = false
      DataMaskingErrorPolicy = "STOP_TASK"
      DataTruncationErrorPolicy = "LOG_ERROR"
      ApplyErrorInsertPolicy = "LOG_ERROR"
      EventErrorPolicy = "IGNORE"
      ApplyErrorEscalationPolicy = "LOG_ERROR"
      RecoverableErrorCount = -1
      DataErrorEscalationCount = 0
      TableErrorEscalationPolicy = "STOP_TASK"
      RecoverableErrorInterval = 5
      ApplyErrorDeletePolicy = "IGNORE_RECORD"
      TableErrorEscalationCount = 0
      FullLoadIgnoreConflicts = true
      DataErrorPolicy = "LOG_ERROR"
      TableErrorPolicy = "SUSPEND_TABLE"
    }
    TTSettings = null
    FullLoadSettings = {
      CommitRate = 5000
      StopTaskCachedChangesApplied = false
      StopTaskCachedChangesNotApplied = false
      MaxFullLoadSubTasks = 4
      TransactionConsistencyTimeout = 600
      CreatePkAfterFullLoad = false
      TargetTablePrepMode = "DROP_AND_CREATE"
    }
    TargetMetadata = {
      ParallelApplyBufferSize = 0
      ParallelApplyQueuesPerThread = 0
      ParallelApplyThreads = 0
      TargetSchema = ""
      InlineLobMaxSize = 0
      ParallelLoadQueuesPerThread = 0
      SupportLobs = true
      LobChunkSize = 0
      TaskRecoveryTableEnabled = false
      ParallelLoadThreads = 0
      LobMaxSize = 104448
      BatchApplyEnabled = false
      FullLobMode = false
      LimitedSizeLobMode = true
      LoadMaxFileSize = 0
      ParallelLoadBufferSize = 0
    }
    BeforeImageSettings = null
    ControlTablesSettings = {
      historyTimeslotInMinutes = 5
      HistoryTimeslotInMinutes = 5
      StatusTableEnabled = false
      SuspendedTablesTableEnabled = false
      HistoryTableEnabled = false
      ControlSchema = ""
      FullLoadExceptionTableEnabled = false
    }
    LoopbackPreventionSettings = null
    CharacterSetSettings = null
    FailTaskWhenCleanTaskResourceFailed = false
    ChangeProcessingTuning = {
      StatementCacheSize = 50
      CommitTimeout = 1
      RecoveryTimeout = -1
      BatchApplyPreserveTransaction = true
      BatchApplyTimeoutMin = 1
      BatchSplitSize = 0
      BatchApplyTimeoutMax = 30
      MinTransactionSize = 1000
      MemoryKeepTime = 30
      BatchApplyMemoryLimit = 1024
      MemoryLimitTotal = 2048
    }
    ChangeProcessingDdlHandlingPolicy = {
      HandleSourceTableDropped = true
      HandleSourceTableTruncated = true
      HandleSourceTableAltered = true
    }
    PostProcessingRules = null
    TimestampColumnName = "edl_load_date"
  })

  tags = {
    Name         = "somano-raw-full-migration-task"
    Environment  = var.environment
    Pod          = var.pod
    Businessunit = var.businessunit
  }
}
